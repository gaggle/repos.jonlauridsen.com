language: node_js
node_js:
- 9
cache:
  directories:
  - node_modules
env:
  global:
  - ENCRYPTION_LABEL: "fd64aa3f06ec"
before_install:
- scripts/ci-prepare
jobs:
  include:
  - stage: scrape
    if: branch = master AND type IN (cron)
    script:
    - npm run scrape && npm run deploy:gh-scraped
  - stage: test
    if: type IN (push, pull_request)
    script:
    - npm test
  - stage: web
    if: branch = master AND type IN (push)
    script:
    - npm run fetch:gh-scraped && npm run export && npm run deploy:gh-pages
